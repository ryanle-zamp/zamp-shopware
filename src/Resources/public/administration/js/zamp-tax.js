!function(){var t={212:function(){},949:function(t,e,a){var n=a(212);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals),(0,a(534).A)("46aca552",n,!0,{})},534:function(t,e,a){"use strict";function n(t,e){for(var a=[],n={},s=0;s<e.length;s++){var i=e[s],o=i[0],r={id:t+":"+s,css:i[1],media:i[2],sourceMap:i[3]};n[o]?n[o].parts.push(r):a.push(n[o]={id:o,parts:[r]})}return a}a.d(e,{A:function(){return v}});var s,i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},r=i&&(document.head||document.getElementsByTagName("head")[0]),d=null,c=0,l=!1,p=function(){},m=null,u="data-vue-ssr-id",h="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function v(t,e,a,s){l=a,m=s||{};var i=n(t,e);return g(i),function(e){for(var a=[],s=0;s<i.length;s++){var r=o[i[s].id];r.refs--,a.push(r)}e?g(i=n(t,e)):i=[];for(var s=0;s<a.length;s++){var r=a[s];if(0===r.refs){for(var d=0;d<r.parts.length;d++)r.parts[d]();delete o[r.id]}}}}function g(t){for(var e=0;e<t.length;e++){var a=t[e],n=o[a.id];if(n){n.refs++;for(var s=0;s<n.parts.length;s++)n.parts[s](a.parts[s]);for(;s<a.parts.length;s++)n.parts.push(b(a.parts[s]));n.parts.length>a.parts.length&&(n.parts.length=a.parts.length)}else{for(var i=[],s=0;s<a.parts.length;s++)i.push(b(a.parts[s]));o[a.id]={id:a.id,refs:1,parts:i}}}}function y(){var t=document.createElement("style");return t.type="text/css",r.appendChild(t),t}function b(t){var e,a,n=document.querySelector("style["+u+'~="'+t.id+'"]');if(n){if(l)return p;n.parentNode.removeChild(n)}if(h){var s=c++;e=w.bind(null,n=d||(d=y()),s,!1),a=w.bind(null,n,s,!0)}else e=z.bind(null,n=y()),a=function(){n.parentNode.removeChild(n)};return e(t),function(n){n?(n.css!==t.css||n.media!==t.media||n.sourceMap!==t.sourceMap)&&e(t=n):a()}}var f=(s=[],function(t,e){return s[t]=e,s.filter(Boolean).join("\n")});function w(t,e,a,n){var s=a?"":n.css;if(t.styleSheet)t.styleSheet.cssText=f(e,s);else{var i=document.createTextNode(s),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(i,o[e]):t.appendChild(i)}}function z(t,e){var a=e.css,n=e.media,s=e.sourceMap;if(n&&t.setAttribute("media",n),m.ssrId&&t.setAttribute(u,e.id),s&&(a+="\n/*# sourceURL="+s.sources[0]+" */",a+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),t.styleSheet)t.styleSheet.cssText=a;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(a))}}}},e={};function a(n){var s=e[n];if(void 0!==s)return s.exports;var i=e[n]={id:n,exports:{}};return t[n](i,i.exports,a),i.exports}a.d=function(t,e){for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="bundles/zamptax/",window?.__sw__?.assetPath&&(a.p=window.__sw__.assetPath+"/bundles/zamptax/"),function(){"use strict";a(949),Shopware.Component.register("zamp-tax-main-page",{template:'<div class="zamp-tax-main-page">\n	<div class="zamp-page">\n		<div class="zamp-page__body">\n			<header class="zamp-page__head-area">\n				<div class="zamp-page__smart-bar">\n					<div class="zamp-navigation">\n						<a href="#/sw/extension/my-extensions/listing/app?limit=25&amp;page=1" class="zamp-navigation__link">\n							&#x2B05; &emsp; {{ $tc(\'buttons.back\') }}</a>\n					</div>\n					<div class="zamp-content">\n						<div class="zamp-page__module-info">\n							<div class="zamp-page__module-icon">\n								<div class="zamp-extension-icon">\n									<img class="zamp-extension-icon__icon" :src="assetFilter(\'/zamptax/Zamp-Logo.png\')" alt="Zamp Logo" width="180">\n								</div>\n							</div>\n						</div>\n						<div class="zamp-page__actions">\n							<p class="zamp-contact-text" id="prompt-text">{{ connected ? $tc(\'labels.quest\') : $tc(\'labels.need\') }}</p>\n							<a class="zamp-button button-link" id="contact-button" target="_blank" rel="noopener" href="https://zamp.com/platforms/shopware">{{ connected ? $tc(\'buttons.contact\') : $tc(\'buttons.create\') }}</a>\n						</div>\n					</div>\n				</div>\n			</header>\n\n			<main class="zamp-page__content">\n				<div class="zamp-api">\n					<div class="zamp-card-wrapper">\n						<div></div>\n						<div class="zamp-api__card">\n							{% block zamp_tabs %}\n\n								<sw-tabs\n									class="zamp-tabs"\n									position-identifier="zamp-tax">\n				\n									{% block zamp_tabs_settings %}\n										<sw-tabs-item\n										:active="activeTab === \'settings\'"\n										name="settings"\n										class="zamp-tabs__tab-settings"\n										@click="onTabChange(\'settings\')"\n										>\n											{{ $tc(\'tabs.settings\') }}\n										</sw-tabs-item>						\n									{% endblock %}\n				\n									{% block zamp_tabs_historical_sync %}\n										<sw-tabs-item\n										:active="activeTab === \'historicalSync\'"\n										:disabled="!connected"\n										name="historicalSync"\n										class="zamp-tabs__tab-historical-sync"\n										@click="onTabChange(\'historicalSync\')"\n										>\n										{{ $tc(\'tabs.historicalSync\') }}\n										</sw-tabs-item>						\n									{% endblock %}\n				\n									{% block zamp_tabs_error_logs %}\n										<sw-tabs-item\n										:active="activeTab === \'errorLogs\'"\n										:disabled="!connected"\n										name="errorLogs"\n										class="zamp-tabs__tab-error-logs"\n										@click="onTabChange(\'errorLogs\')"\n										>\n										{{ $tc(\'tabs.errorLogs\') }}\n										</sw-tabs-item>						\n									{% endblock %}\n								</sw-tabs>\n							{% endblock %}\n\n							{% block zamp_settings_form %}\n							<template\n							v-if="activeTab === \'settings\'">\n								<div class="zamp-api__card__header">\n									<div class="zamp-api__card__titles">\n										<div class="zamp-api__card__title">{{ $tc(\'cards.settings\') }}</div>\n									</div>\n								</div>\n								<div class="gray-divide"></div>\n								<div class="zamp-api__card__content">\n									<form action="" id="zamp-token-form">\n										<div class="zamp-api-input-wrapper">\n											<div class="zamp-field" :label="$tc(\'labels.token\')">\n												<div class="zamp-field-label">\n													<label for="zamp-token-input">{{ $tc(\'labels.token\') }}</label>\n												</div>\n												<div class="zamp-field-input">\n													<input type="password" :placeholder="$tc(\'places.token\')" maxlength="64" id="zamp-token-input" autocomplete="off">\n												</div>\n											</div>\n										</div>\n										<div class="zamp-button-wrapper">\n											<button id="token-button" type="submit" class="zamp-button">{{ connected ? $tc(\'buttons.update\') : $tc(\'buttons.connect\') }}</button>\n										</div>\n										<small id="small-disclaimer-text">{{ connected ? $tc(\'disclaim.connected\') : $tc(\'disclaim.disclaimer\') }}</small>\n									</form>\n\n								</div>\n								<div class="gray-divide"></div>\n								<div class="zamp-api__card__content">\n									<form action="" id="zamp-settings-form">\n										<div class="zamp-state-input-wrapper">\n											<div class="zamp-field" :label="$tc(\'labels.state\')">\n												<div class="zamp-select-input">\n													<sw-multi-select\n														v-model="selectedStates"\n														:options="stateOptions"\n														labelProperty="name"\n														valueProperty="code"\n														:placeholder="$tc(\'places.states\')"\n														:searchable="true"\n														:multiple="true"\n														:disabled="!connected"\n													></sw-multi-select>\n												</div>\n											</div>\n										</div>\n										<div class="zamp-calc-input-wrapper">\n											<div class="zamp-field" :label="$tc(\'switches.allow\')">\n												<div id="zamp-calc-input" class="zamp-calc-input">\n													<sw-switch-field\n														v-model="calcEnabled"\n														:disabled="!connected"\n														:label="$tc(\'switches.allow\')"\n													></sw-switch-field>\n												</div>\n											</div>\n										</div>\n										<div class="zamp-trans-input-wrapper">\n											<div class="zamp-field" :label="$tc(\'switches.send\')">\n												<div id="zamp-trans-input" class="zamp-trans-input">\n													<sw-switch-field\n														v-model="transEnabled"\n														:disabled="!connected"\n														:label="$tc(\'switches.send\')"\n													></sw-switch-field>\n												</div>\n											</div>\n										</div>\n\n										<div class="zamp-button-wrapper">\n											<button id="config-button" type="submit" :disabled="!connected" class="zamp-button">{{ $tc(\'buttons.save\') }}</button>\n										</div>\n										\n									</form>\n\n								</div>\n								<div class="gray-divide-last"></div>\n							</template>	\n							{% endblock %}\n\n							{% block zamp_historical_sync_form %}\n								<template\n								v-if="activeTab === \'historicalSync\'">\n									<div class="zamp-api__card__header">\n										<div class="zamp-api__card__titles">\n											<div class="zamp-api__card__title">{{ $tc(\'cards.historicalSync\') }}</div>\n										</div>\n									</div>\n									<div class="gray-divide"></div>\n									<div class="zamp-api__card__content">\n										<form action="" id="historical-data-form" style="display: grid; grid-template-columns: 50% 1fr; grid-template-rows: auto auto; grid-column-gap: 16px; grid-template-areas: \'input input\'\'button context\';">\n											<div class="zamp-sync-input-wrapper">\n												<div class="zamp-field" :label="$tc(\'labels.start\')">\n													<div class="zamp-field-label">\n														<label for="zamp-sync-start-input">{{ $tc(\'labels.start\') }}</label>\n													</div>\n													<div class="zamp-field-input">\n														<input style="outline: none; border: 0px; padding: 6px; width: 100%;" type="date" id="zamp-sync-start-input" min="2022-01-01" autocomplete="off">\n													</div>\n												</div>\n											</div>\n											<div class="zamp-sync-input-wrapper">\n												<div class="zamp-field" :label="$tc(\'labels.end\')">\n													<div class="zamp-field-label">\n														<label for="zamp-sync-end-input">{{ $tc(\'labels.end\') }}</label>\n													</div>\n													<div class="zamp-field-input">\n														<input style="outline: none;  border: 0px; padding: 6px; width: 100%;" type="date" id="zamp-sync-end-input" min="2022-01-01" autocomplete="off">\n													</div>\n												</div>\n											</div>\n											<div class="zamp-button-wrapper">\n												<button id="sync-button" type="submit" class="zamp-button">{{ $tc(\'buttons.sync\') }}</button>\n												<small id="small-warning-text"></small>\n											</div>\n										</form>										\n	\n									</div>\n									<div class="gray-divide"></div>\n									<div class="zamp-api__card__content">\n										<sw-data-grid\n											:showSelection="false"\n											:showActions="false"\n											:dataSource="[\n												{ id: \'syncRequested\', status: $tc(\'status.request\'), count: totalSyncRequested },\n												{ id: \'syncRequested\', status: $tc(\'status.complete\'), count: totalSyncCompleted },\n												{ id: \'syncExists\', status: $tc(\'status.already\'), count: totalSyncExists },\n												{ id: \'syncUpdated\', status: $tc(\'status.update\'), count: totalSyncUpdated },\n												{ id: \'syncRequested\', status: $tc(\'status.fail\'), count: totalSyncFailed }\n												\n											]"\n\n											:columns="[\n												{ property: \'status\', label: $tc(\'status.stat\')},\n												{ property: \'count\', label: $tc(\'status.count\') }\n											]">\n										</sw-data-grid>\n									</div>\n									<div class="gray-divide-last"></div>\n								</template>\n\n							{% endblock %}\n\n                            {% block zamp_logs_form %}\n								<template\n								v-if="activeTab === \'errorLogs\'">\n									<div class="zamp-api__card__header">\n										<div class="zamp-api__card__titles">\n											<div class="zamp-api__card__title">{{ $tc(\'cards.errorLogs\') }}</div>\n										</div>\n									</div>\n									<div class="gray-divide"></div>\n									<div class="zamp-api__card__content">\n										<form action="" id="zamp-logs-form" style="display: grid; grid-template-columns: 50% 1fr; grid-template-rows: auto auto; grid-column-gap: 16px; grid-template-areas: \'input input\' \'button button\';">\n											<div class="zamp-logs-input-wrapper">\n												<div class="zamp-field" :label="$tc(\'labels.date\')">\n													<div class="zamp-field-label">\n														<label for="zamp-logs-date-input">{{ $tc(\'labels.date\') }}</label>\n													</div>\n													<div class="zamp-field-input">\n														<input style="outline: none; border: 0px; padding: 6px; width: 100%;" type="date" id="zamp-logs-date-input" min="2022-01-01">\n													</div>\n												</div>\n											</div>\n											<div class="zamp-logs-input-wrapper">\n\n											</div>\n											<div class="zamp-button-wrapper">\n												<button id="logs-button" type="submit" class="zamp-button">{{ $tc(\'buttons.get\') }}</button>\n												<small id="small-logs-text"></small>\n											</div>\n                                            <div class="zamp-button-wrapper">\n                                                <button id="logs-down-button" type="button" class="zamp-button">{{ $tc(\'buttons.down\') }}</button>\n                                                <pre style="display: none; width: 0px; height: 0px;" id="small-logs-down-text"></pre>\n                                            </div>\n											\n										</form>										\n                                        \n									</div>\n\n                                    <hr/>\n\n									<div class="zamp-api__card__content" id="logs-ui">\n										\n									</div>\n                                    \n									<div class="gray-divide-last"></div>\n								</template>\n\n							{% endblock %}\n													\n						</div>\n						<div></div>\n					</div>\n				</div>\n			</main>\n		</div>\n	</div>\n</div>\n',inject:["repositoryFactory"],data:function(){return{activeTab:"settings",connected:!1,entityId:"",entity:void 0,paidEntity:void 0,paidId:"",paidOrders:[],calcEnabled:!1,transEnabled:!1,selectedStates:[],stateOptions:[{code:"AL",name:"AL - Alabama"},{code:"AK",name:"AK - Alaska"},{code:"AZ",name:"AZ - Arizona"},{code:"AR",name:"AR - Arkansas"},{code:"CA",name:"CA - California"},{code:"CO",name:"CO - Colorado"},{code:"CT",name:"CT - Connecticut"},{code:"DE",name:"DE - Delaware"},{code:"DC",name:"DC - District of Columbia"},{code:"FL",name:"FL - Florida"},{code:"GA",name:"GA - Georgia"},{code:"HI",name:"HI - Hawaii"},{code:"ID",name:"ID - Idaho"},{code:"IL",name:"IL - Illinois"},{code:"IN",name:"IN - Indiana"},{code:"IA",name:"IA - Iowa"},{code:"KS",name:"KS - Kansas"},{code:"KY",name:"KY - Kentucky"},{code:"LA",name:"LA - Louisiana"},{code:"ME",name:"ME - Maine"},{code:"MD",name:"MD - Maryland"},{code:"MA",name:"MA - Massachusetts"},{code:"MI",name:"MI - Michigan"},{code:"MN",name:"MN - Minnesota"},{code:"MS",name:"MS - Mississippi"},{code:"MO",name:"MO - Missouri"},{code:"MT",name:"MT - Montana"},{code:"NE",name:"NE - Nebraska"},{code:"NV",name:"NV - Nevada"},{code:"NH",name:"NH - New Hampshire"},{code:"NJ",name:"NJ - New Jersey"},{code:"NM",name:"NM - New Mexico"},{code:"NY",name:"NY - New York"},{code:"NC",name:"NC - North Carolina"},{code:"ND",name:"ND - North Dakota"},{code:"OH",name:"OH - Ohio"},{code:"OK",name:"OK - Oklahoma"},{code:"OR",name:"OR - Oregon"},{code:"PA",name:"PA - Pennsylvania"},{code:"PR",name:"PR - Puerto Rico"},{code:"RI",name:"RI - Rhode Island"},{code:"SC",name:"SC - South Carolina"},{code:"SD",name:"SD - South Dakota"},{code:"TN",name:"TN - Tennessee"},{code:"TX",name:"TX - Texas"},{code:"UT",name:"UT - Utah"},{code:"VT",name:"VT - Vermont"},{code:"VA",name:"VA - Virginia"},{code:"WA",name:"WA - Washington"},{code:"WV",name:"WV - West Virginia"},{code:"WI",name:"WI - Wisconsin"},{code:"WY",name:"WY - Wyoming"}],totalSyncRequested:0,totalSyncCompleted:0,totalSyncExists:0,totalSyncUpdated:0,totalSyncFailed:0,orders:[]}},computed:{assetFilter(){return Shopware.Filter.getByName("asset")},zampSettingsRepository(){return this.repositoryFactory.create("zamp_settings")},orderRepository(){return this.repositoryFactory.create("order")},orderTransactionRepository(){return this.repositoryFactory.create("order_transaction")},stateTransalationRepository(){return this.repositoryFactory.create("state_machine_state_translation")}},mixins:[Shopware.Mixin.getByName("notification")],created(){let t=Shopware.Utils.createId(),e=new Shopware.Data.Criteria;this.zampSettingsRepository.search(e,Shopware.Context.api).then(e=>{e.length>0?(this.entity=e.first(),this.entityId=e.first().id,null!==this.entity.apiToken&&(document.querySelector("#zamp-token-input").value=this.entity.apiToken,document.querySelector("#small-disclaimer-text").classList.add("green-text"),this.connected=!0),null!==this.entity.taxableStates&&(this.selectedStates=this.entity.taxableStates.split(",")),this.entity.calculationsEnabled&&(this.calcEnabled=!0),this.entity.transactionsEnabled&&(this.transEnabled=!0)):(this.entity=this.zampSettingsRepository.create(Shopware.Context.api),this.entity.id=t,this.entityId=t,this.zampSettingsRepository.save(this.entity,Shopware.Context.api))})},watch:{selectedStates:"updateSelectedStates",activeTab(t){"settings"==t?(this.$nextTick(()=>{let t=document.getElementById("zamp-token-form"),e=document.getElementById("zamp-settings-form");t&&t.addEventListener("submit",t=>{this.testToken(t)}),e&&e.addEventListener("submit",t=>{this.saveConfig(t)});let a=Shopware.Utils.createId(),n=new Shopware.Data.Criteria;this.zampSettingsRepository.search(n,Shopware.Context.api).then(t=>{t.length>0?(this.entity=t.first(),this.entityId=t.first().id,null!==this.entity.apiToken&&(document.querySelector("#zamp-token-input").value=this.entity.apiToken,document.querySelector("#small-disclaimer-text").classList.add("green-text"),this.connected=!0),null!==this.entity.taxableStates&&(this.selectedStates=this.entity.taxableStates.split(",")),this.entity.calculationsEnabled&&(this.calcEnabled=!0),this.entity.transactionsEnabled&&(this.transEnabled=!0)):(this.entity=this.zampSettingsRepository.create(Shopware.Context.api),this.entity.id=a,this.entityId=a,this.zampSettingsRepository.save(this.entity,Shopware.Context.api))})}),this.observeDOM()):"historicalSync"===t?this.$nextTick(()=>{let t=document.getElementById("historical-data-form");document.querySelector("#small-warning-text").innerText="",t&&t.addEventListener("submit",t=>{this.syncHistory(t)})}):"errorLogs"===t&&this.$nextTick(()=>{let t=document.getElementById("zamp-logs-form");if(document.querySelector("#small-logs-text").innerText="",t){t.addEventListener("submit",t=>{this.loadLog(t)});let a=document.getElementById("zamp-logs-date-input"),n=new Date().toISOString().split("T")[0];a.value=n;var e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",document.head.appendChild(e),document.getElementById("logs-down-button").addEventListener("click",t=>{this.downloadLog(t)})}})}},mounted(){let t=document.getElementById("zamp-token-form"),e=document.getElementById("zamp-settings-form");t&&t.addEventListener("submit",t=>{this.testToken(t)}),e&&e.addEventListener("submit",t=>{this.saveConfig(t)}),this.observeDOM()},methods:{downloadLog(t){t.preventDefault();let{jsPDF:e}=window.jspdf,a=new e,n=document.getElementById("zamp-logs-date-input"),s=document.getElementById("logs-ui"),i=n.value;if(!i){s.textContent=this.$tc("messages.date");return}let o=Shopware.Context.api.authToken.access;Shopware.Application.getContainer("init").httpClient.get(`/v1/_action/zamp-tax/logs?date=${i}`,{headers:{Authorization:`Bearer ${o}`}},Shopware.Context.api).then(t=>{if(s.textContent=this.$tc("messages.init"),!t.data.log){s.textContent=this.$tc("errors.log");return}let e=`Zamp Shopware Log ${i}`,n=new DOMParser().parseFromString(t.data.log,"text/html").documentElement.textContent.split("\n"),o=a.internal.pageSize.height,r=a.internal.pageSize.width;a.setFontSize(16),a.text(e,15,31),a.setFontSize(12);let d=36;n.forEach(t=>{a.splitTextToSize(t,r-30).forEach(t=>{d+10>o-15&&(a.addPage(),d=15),a.text(t,15,d),d+=10})}),a.save(`Zamp-Shopware-log-${i}.pdf`)}).catch(t=>{s.textContent=this.$tc("errors.log"),console.error("Error fetching log for download: ",t)})},loadLog(t){t.preventDefault();let e=document.getElementById("zamp-logs-date-input"),a=document.getElementById("logs-ui"),n=e.value;if(!n){a.textContent=this.$tc("messages.date");return}let s=Shopware.Context.api.authToken.access;Shopware.Application.getContainer("init").httpClient.get(`/v1/_action/zamp-tax/logs?date=${n}`,{headers:{Authorization:`Bearer ${s}`}},Shopware.Context.api).then(t=>{a.innerHTML=`<pre>${t.data.log}</pre>`}).catch(t=>{a.textContent=this.$tc("errors.log"),console.error("Error fetching file content:",t),t.response&&t.response.data&&(console.log("Backend error message:",t.response.data.message),console.log("Full backend response:",t.response.data))})},onTabChange(t){this.activeTab=t},syncHistory(t){t.preventDefault();let e=Shopware.Context.api.authToken.access,a="",n=new Shopware.Data.Criteria;this.zampSettingsRepository.search(n,Shopware.Context.api).then(t=>{if(t.length>0){let{Criteria:s}=Shopware.Data;this.entity=t.first(),this.entityId=t.first().id,null!==this.entity.apiToken&&(a=this.entity.apiToken);let i=new Shopware.Data.Criteria;i.addFilter(s.equals("name","Paid")),this.stateTransalationRepository.search(i,Shopware.Context.api).then(t=>{if(t.length>0){this.paidEntity=t.first(),this.paidId=t.first().stateMachineStateId;let e=new Shopware.Data.Criteria;e.addFilter(s.equals("stateId",this.paidId)),this.orderTransactionRepository.search(e,Shopware.Context.api).then(t=>{t.length>0&&t.forEach(t=>{this.paidOrders.includes(t.orderId)||this.paidOrders.push(t.orderId)})})}});let o=document.getElementById("zamp-sync-start-input").value,r=document.getElementById("zamp-sync-end-input").value;if(""==o&&(o="2022-01-01"),""==r){let t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");r=`${e}-${a}-${n} 23:59:59`}else{let t=new Date(r),e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");r=`${e}-${a}-${n} 23:59:59`}let d=new Shopware.Data.Criteria;n.addSorting(s.sort("createdAt","DESC")),this.orderRepository.search(d,Shopware.Context.api).then(t=>{let n={};t.forEach(t=>{n[t.id]||(n[t.id]=t)});let s=Object.values(n).filter(t=>{let e=new Date(t.createdAt),a=new Date(o),n=new Date(r);return e>=a&&e<=n});this.orders=s,this.totalSyncRequested=this.orders.length,this.totalSyncCompleted=0,this.totalSyncFailed=0,this.totalSyncExists=0,this.orders.forEach(t=>{var n=new FormData;n.append("order_id",t.id),n.append("token",a);let s=Shopware.Context.api.apiPath;fetch(`${s}/v1/_action/zamp-tax/sync-order`,{headers:{Authorization:`Bearer ${e}`},method:"POST",body:n}).then(t=>t.json()).then(t=>{"completed"==t.status?this.totalSyncCompleted+=1:"exists"==t.status?this.totalSyncExists+=1:"failed"==t.status&&(this.totalSyncFailed+=1)})})}).catch(t=>{console.error("Error fetching orders: ",t)})}else document.querySelector("#small-warning-text").innerText=this.$tc("messages.syncwarn")})},testToken(t){t.preventDefault();let e=Shopware.Context.api.authToken.access,a=document.querySelector("#zamp-token-input").value.trim(),n=Shopware.Context.api.apiPath;fetch(`${n}/v1/_action/zamp-tax/test-api`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({token:a})}).then(async t=>{if(!t.ok){let e=await t.text();throw console.error("Bad response:",t.status,e),Error(`HTTP ${t.status}`)}return t.json()}).then(t=>{t.valid?(this.entity.apiToken=a,this.zampSettingsRepository.get(this.entityId,Shopware.Context.api).then(t=>{this.entity=t,this.entity.apiToken=a,this.zampSettingsRepository.save(this.entity,Shopware.Context.api).then(()=>{this.createNotificationSuccess({title:this.$tc("global.default.success"),message:this.$tc("messages.successtoken")}),this.connected=!0,document.querySelector("#zamp-token-input").value=this.entity.apiToken,document.querySelector("#small-disclaimer-text")?.classList.add("green-text")})})):(this.createNotificationError({title:this.$tc("global.notification.unspecifiedSaveErrorMessage"),message:this.$tc("messages.failtoken")}),this.connected=!1)}).catch(t=>{console.error("Token check failed:",t),this.createNotificationError({title:this.$tc("global.notification.unspecifiedSaveErrorMessage"),message:this.$tc("messages.failtoken")}),this.connected=!1})},updateSelectedStates(){let t=document.querySelector(".sw-select-selection-list__input");if(t){t.innerHTML="",this.selectedStates.forEach(e=>{let a=document.createElement("li");a.className="sw-select-selection-list__item-holder",a.dataset.id=e.code;let n=document.createElement("span");n.className="sw-label sw-label--appearance-default sw-label--size-default sw-label--dismissable";let s=document.createElement("span");s.className="sw-label__caption";let i=document.createElement("span");i.className="sw-select-selection-list__item",i.textContent=`${e.code} - ${e.name}`,s.appendChild(i),n.appendChild(s);let o=document.createElement("button");o.className="sw-label__dismiss",o.title="Remove",o.setAttribute("data-state",e.code);let r=document.createElement("span");r.className="sw-icon sw-icon--fill icon--regular-times-s",r.innerHTML='<svg id="meteor-icon-kit__regular-times-s" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 4.5858L10.2929 0.29289C10.6834 -0.09763 11.3166 -0.09763 11.7071 0.29289C12.0976 0.68342 12.0976 1.31658 11.7071 1.70711L7.4142 6L11.7071 10.2929C12.0976 10.6834 12.0976 11.3166 11.7071 11.7071C11.3166 12.0976 10.6834 12.0976 10.2929 11.7071L6 7.4142L1.70711 11.7071C1.31658 12.0976 0.68342 12.0976 0.29289 11.7071C-0.09763 11.3166 -0.09763 10.6834 0.29289 10.2929L4.5858 6L0.29289 1.70711C-0.09763 1.31658 -0.09763 0.68342 0.29289 0.29289C0.68342 -0.09763 1.31658 -0.09763 1.70711 0.29289L6 4.5858z" fill="#758CA3"></path></svg>',o.appendChild(r),n.appendChild(o),a.appendChild(n),t.appendChild(a)});let e=document.createElement("li");e.innerHTML='<input class="sw-select-selection-list__input" type="text" placeholder="" value="">',t.appendChild(e)}},observeDOM(){let t=document.body,e={childList:!0,subtree:!0};this.calcEventListenersAdded=!1,this.transEventListenersAdded=!1,this.retainLogsEventAdded=!1,this.observer=new MutationObserver(a=>{let n=!1;for(let t of a)if("childList"===t.type){let t=document.querySelector("#zamp-calc-input");if(t){let e=Array.from(t.querySelectorAll("*")).find(t=>t.id.startsWith("sw-field--"));e&&!this.calcEventListenersAdded&&(e.addEventListener("click",t=>{this.calcEnabled?this.calcEnabled=!1:this.calcEnabled=!0}),this.calcEventListenersAdded=!0)}let e=document.querySelector("#zamp-trans-input");if(e){let t=Array.from(e.querySelectorAll("*")).find(t=>t.id.startsWith("sw-field--"));t&&!this.transEventListenersAdded&&(t.addEventListener("click",t=>{this.transEnabled?this.transEnabled=!1:this.transEnabled=!0}),this.transEventListenersAdded=!0)}let a=document.querySelectorAll("li.sw-select-result");if(a.length>0){n=!0,a.forEach(t=>{t.addEventListener("click",e=>{let a=t.querySelector("div.sw-highlight-text").innerText.split(" - ")[0];this.selectedStates.includes(a)||this.selectedStates.push(a)})});break}let s=document.querySelectorAll("button.sw-label__dismiss");if(s.length>0){s.forEach(t=>{t.addEventListener("click",e=>{let a=t.parentElement.parentElement.getAttribute("data-id");this.selectedStates.includes(a)&&(this.selectedStates=this.selectedStates.filter(t=>t!==a))})});break}}n||this.observer.observe(t,e)}),t&&this.observer.observe(t,e)},saveConfig(t){t.preventDefault();let e=this.selectedStates.join(",");this.entity.taxableStates=e,this.entity.calculationsEnabled=this.calcEnabled,this.entity.transactionsEnabled=this.transEnabled,this.zampSettingsRepository.save(this.entity,Shopware.Context.api).then(()=>{this.createNotificationSuccess({title:this.$tc("global.default.success"),message:this.$tc("messages.success")}),this.zampSettingsRepository.get(this.entityId,Shopware.Context.api).then(t=>{this.entity=t})}).catch(t=>{this.createNotificationError({title:this.$tc("global.notification.unspecifiedSaveErrorMessage"),message:this.$tc("messages.fail")+t.message})})}},beforeUnmount(){this.observer&&this.observer.disconnect()}}),Shopware.Module.register("zamp-tax",{type:"plugin",name:"zamp-tax",title:"Zamp Tax",description:"Zamp Tax Plugin",color:"#5075d3",icon:"default-action-settings",routes:{dashboard:{component:"zamp-tax-main-page",path:"dashboard",meta:{allow:["user","admin"]}}},navigation:[{label:"Zamp Tax",color:"#5075d3",path:"zamp.tax.dashboard",icon:"default-action-settings",parent:"sw-extension",position:100}]});let{Component:t,Mixin:e}=Shopware;t.override("sw-settings-customer-group-detail",{template:'{% extends \'@Administration/module/sw-settings-customer-group/page/sw-settings-customer-group-detail.html.twig\' %}\n\n	{% block sw_settings_customer_group_detail_content_card %}\n		{% parent %}\n	\n		<sw-card\n			:is-loading="isLoading"\n			title="Entity Exemption"\n			position-identifier="sw-settings-customer-group-detail-content"\n		>\n			<template>\n				<sw-container\n				>\n				{% block sw_settings_customer_group_detail_content_card_tax_exempt_code %}\n					<sw-text-field\n						v-model:value="customerGroup.taxExemptCode"\n						label="Entity Exemption Code"\n						class="sw-customer-group-tax-exempt-code"\n						placeholder="Enter entity exemption code"\n					/>\n				{% endblock %}\n				</sw-container>\n	\n			</template>\n		</sw-card>\n	\n		\n	{% endblock %}',computed:{customerGroup(){return this.$super("customerGroup")},customerGroupRepository(){return this.repositoryFactory.create("customer_group")}},watch:{customerGroup(t){t.customFields&&t.customFields.tax_exempt_code&&(this.customerGroup.taxExemptCode=t.customFields.tax_exempt_code)}},methods:{onSave(){this.$super("onSave");let t=this.customerGroup.customFields||{};t.tax_exempt_code=this.customerGroup.taxExemptCode,this.customerGroup.customFields=t;var e=this.customerGroup.id;this.customerGroupRepository.save(this.customerGroup).then(()=>this.customerGroupRepository.get(e,Shopware.Context.api)).then(t=>{this.customerGroup=t}).catch(t=>{console.error("Failed to save customer group: ",t),t.response&&t.response.data&&console.error("Error response data: ",t.response.data),this.createNotificationError({message:this.$tc("sw-settings.customerGroup.detail.saveError",0)})})}}}),t.override("sw-product-detail-base",{template:'{% extends \'@Administration/module/sw-product/view/sw-product-detail-base/sw-product-detail-base.html.twig\' %}\n\n	{% block sw_product_detail_base %}\n		{% parent %}\n		\n		<sw-card\n			:is-loading="isLoading"\n			title="Zamp Product Tax Code"\n			position-identifier="sw-product-detail-zamp-tax-code"\n		>\n			<sw-container>\n				<sw-text-field\n                    id="zamp-product-tax-code-input"\n					v-model:value="zampProductTaxCode"\n					label="Zamp Product Tax Code"\n					class="sw-zamp-product-tax-code"\n					placeholder="Enter Zamp Product Tax code"\n				/>\n			</sw-container>\n		</sw-card>\n	\n	{% endblock %}',data:function(){return{zampProductTaxCode:"",zampProductId:"",zampEntityId:"",zampEntity:{}}},computed:{product(){return this.$super("product")},productRepository(){return this.repositoryFactory.create("product")},zampProductTaxCodeRepository(){return this.repositoryFactory.create("zamp_product_tax_code")}},watch:{product(t){if(t){this.zampProductId=t.id;let{Criteria:e}=Shopware.Data;Shopware.Utils.createId();let a=new Shopware.Data.Criteria;a.addFilter(e.equals("productId",t.id)),this.zampProductTaxCodeRepository.search(a,Shopware.Context.api).then(t=>{t.length>0&&(this.zampEntity=t.first(),this.zampEntityId=t.first().id,null!==this.zampEntity.productId&&(this.zampProductId=this.zampEntity.productId),null!==this.zampEntity.productTaxCode&&(this.zampProductTaxCode=this.zampEntity.productTaxCode))})}}},methods:{getTaxCode(){return this.zampProductTaxCode}}}),t.override("sw-product-detail",{data(){return{productTaxCode:"",zampProductId:"",zampEntity:{}}},computed:{zampProductTaxCodeRepository(){return this.repositoryFactory.create("zamp_product_tax_code")},product(){return this.$super("product")}},methods:{onSave(){this.$super("onSave").then(()=>{let t=this.product.id,e=document.querySelector("#zamp-product-tax-code-input .sw-block-field__block input").value;if(t&&e){let a=new Shopware.Data.Criteria,{Criteria:n}=Shopware.Data;a.addFilter(n.equals("productId",t)),this.zampProductTaxCodeRepository.search(a,Shopware.Context.api).then(a=>{if(a.length>0){this.zampEntity=a.first();let t=this.zampEntity.id;return this.zampEntity.productTaxCode=e,this.zampProductTaxCodeRepository.save(this.zampEntity,Shopware.Context.api).then(()=>(this.createNotificationSuccess({title:"Success",message:"Product updated successfully."}),this.zampProductTaxCodeRepository.get(t,Shopware.Context.api))).then(t=>{this.zampEntity=t})}{this.zampEntity=this.zampProductTaxCodeRepository.create(Shopware.Context.api);let a=Shopware.Utils.createId();return this.zampEntity.id=a,this.zampEntity.productId=t,this.zampEntity.productTaxCode=e,this.zampProductTaxCodeRepository.save(this.zampEntity,Shopware.Context.api).then(()=>(this.createNotificationSuccess({title:"Success",message:"Product saved successfully."}),this.zampProductTaxCodeRepository.get(this.zampEntity.id,Shopware.Context.api))).then(t=>{this.zampEntity=t})}}).catch(t=>{this.createNotificationError({title:"Error",message:"Failed to save or update Zamp Product Tax Code: "+t.message})})}}).catch(t=>{console.error("Failed to save product:",t),this.createNotificationError({title:"Error",message:"Failed to save product: "+t.message})})}}})}()}();